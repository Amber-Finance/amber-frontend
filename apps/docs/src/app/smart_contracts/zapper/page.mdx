# Zapper

The Zapper contract enables multi-step strategy execution and automated position management for Amber Finance. It allows users to execute complex DeFi operations through a single transaction, combining multiple actions like deposits, swaps, and strategy implementations.

---

### Deployment

- **Neutron**: `neutron1595ht54wjekzku0k4z2a485072ntr9cwdr5d3y5qc4qv59y2pmsqmsg6aw`

---

### Types

```ts
type Uint128 = string
type Addr = string
type Decimal = string
```

---

### Queries

#### `config`

Returns the contract's configuration.

```ts
{
  config: {}
}
```

**Response:**

```ts
{
  data: {
    address_provider: Addr
    owner?: Addr | null
    proposed_new_owner?: Addr | null
  }
}
```

---

#### `owner`

Returns contract ownership details.

```ts
{
  owner: {}
}
```

**Response:**

```ts
{
  data: {
    owner?: Addr | null
    proposed_new_owner?: Addr | null
  }
}
```

---

#### `strategy_templates`

Returns available strategy templates.

```ts
{
  strategy_templates: {
    limit?: number | null
    start_after?: string | null
  }
}
```

**Response:**

```ts
{
  data: {
    templates: [
      {
        id: string
        name: string
        description: string
        actions: Action[]
        risk_level: string
      },
      ...
    ]
  }
}
```

---

#### `strategy_template`

Returns a specific strategy template.

```ts
{
  strategy_template: {
    id: string
  }
}
```

**Response:**

```ts
{
  data: {
    id: string
    name: string
    description: string
    actions: Action[]
    risk_level: string
    parameters: {
      min_health_factor: Decimal
      max_slippage: Decimal
    }
  }
}
```

---

#### `user_strategies`

Returns strategies for a specific user.

```ts
{
  user_strategies: {
    user: Addr
    limit?: number | null
    start_after?: string | null
  }
}
```

**Response:**

```ts
{
  data: {
    strategies: [
      {
        id: string
        template_id: string
        status: string
        created_at: number
        last_executed: number
        total_value: Uint128
      },
      ...
    ]
  }
}
```

---

#### `strategy_status`

Returns the status of a specific strategy.

```ts
{
  strategy_status: {
    strategy_id: string
  }
}
```

**Response:**

```ts
{
  data: {
    id: string
    template_id: string
    status: string
    created_at: number
    last_executed: number
    total_value: Uint128
    health_factor: Decimal
    next_execution_time: number
  }
}
```

---

### Methods

#### `execute_strategy`

Executes a strategy template with custom parameters.

```ts
{
  execute_strategy: {
    template_id: string
    parameters: {
      min_health_factor: Decimal
      max_slippage: Decimal
      custom_actions?: Action[]
    }
  }
}
```

---

#### `create_strategy`

Creates a new strategy from a template.

```ts
{
  create_strategy: {
    template_id: string
    name: string
    parameters: {
      min_health_factor: Decimal
      max_slippage: Decimal
      custom_actions?: Action[]
    }
  }
}
```

---

#### `update_strategy`

Updates an existing strategy.

```ts
{
  update_strategy: {
    strategy_id: string
    parameters: {
      min_health_factor?: Decimal | null
      max_slippage?: Decimal | null
      custom_actions?: Action[] | null
    }
  }
}
```

---

#### `pause_strategy`

Pauses a strategy execution.

```ts
{
  pause_strategy: {
    strategy_id: string
  }
}
```

---

#### `resume_strategy`

Resumes a paused strategy.

```ts
{
  resume_strategy: {
    strategy_id: string
  }
}
```

---

#### `delete_strategy`

Deletes a strategy.

```ts
{
  delete_strategy: {
    strategy_id: string
  }
}
```

---

#### `update_owner`

Updates the contract owner (admin only).

```ts
{
  update_owner: {
    new_owner: Addr
  }
}
```

---

#### `accept_ownership`

Accepts ownership transfer (proposed owner only).

```ts
{
  accept_ownership: {}
}
```

---

### Strategy Templates

The Zapper provides pre-configured strategy templates:

#### Basic Deposit Strategy
- **Description**: Simple deposit with optimal BRT selection
- **Actions**: Deposit → Optimize allocation
- **Risk Level**: Low

#### Yield Optimization Strategy
- **Description**: Maximize yields through BRT rotation
- **Actions**: Deposit → Swap → Rebalance
- **Risk Level**: Medium

#### Leverage Strategy
- **Description**: Amplify returns through borrowing
- **Actions**: Deposit → Borrow → Swap → Deposit
- **Risk Level**: High

#### Loop Strategy
- **Description**: Maximize capital efficiency through looping
- **Actions**: Deposit → Borrow → Swap → Deposit (repeated)
- **Risk Level**: High

#### Risk Management Strategy
- **Description**: Maintain optimal health factors
- **Actions**: Monitor → Rebalance → Adjust
- **Risk Level**: Low

---

### Action Types

The Zapper supports various action types:

#### Deposit Actions
```ts
{
  deposit: {
    denom: string
    amount: Uint128
  }
}
```

#### Swap Actions
```ts
{
  swap: {
    from_denom: string
    to_denom: string
    amount: Uint128
    min_receive: Uint128
  }
}
```

#### Borrow Actions
```ts
{
  borrow: {
    denom: string
    amount: Uint128
  }
}
```

#### Repay Actions
```ts
{
  repay: {
    denom: string
    amount: Uint128
  }
}
```

#### Conditional Actions
```ts
{
  conditional: {
    condition: {
      health_factor: {
        comparison: string
        threshold: Decimal
      }
    }
    actions: Action[]
  }
}
```

---

### Usage Examples

#### Execute Basic Strategy

```bash
curl -X POST "https://api.neutron.org/zapper/execute_strategy" \
  -H "Content-Type: application/json" \
  -d '{
    "template_id": "basic_deposit",
    "parameters": {
      "min_health_factor": "1.5",
      "max_slippage": "0.01"
    }
  }'
```

#### Create Custom Strategy

```bash
curl -X POST "https://api.neutron.org/zapper/create_strategy" \
  -H "Content-Type: application/json" \
  -d '{
    "template_id": "yield_optimization",
    "name": "My Custom Strategy",
    "parameters": {
      "min_health_factor": "1.8",
      "max_slippage": "0.005"
    }
  }'
```

#### Get User Strategies

```bash
curl -X GET "https://api.neutron.org/zapper/user_strategies" \
  -H "Content-Type: application/json" \
  -d '{"user": "neutron1..."}'
```

---

### Integration

The Zapper integrates with:

1. **Credit Manager** - Executes complex multi-step operations
2. **Red Bank** - Manages lending and borrowing actions
3. **Swapper** - Handles asset exchanges
4. **Health Computer** - Monitors position health
5. **Frontend Applications** - Provides strategy management interfaces

---

### Benefits

- **Automation** - Execute complex strategies with single transactions
- **Risk Management** - Built-in health factor monitoring
- **Optimization** - Pre-configured strategies for common use cases
- **Flexibility** - Custom strategy creation and modification
- **Gas Efficiency** - Batch multiple actions to reduce costs

---

*This documentation reflects the Mars Protocol Zapper contract as deployed by Amber Finance on Neutron.*
